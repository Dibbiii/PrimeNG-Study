<div class="p-5 surface-ground min-h-screen">
  <div class="grid">
    <div class="col-12 md:col-6">
      <p-card header="Organigramma Aziendale Gerarchico">
        <p-tree
          [value]="files()"
          selectionMode="single"
          [(selection)]="selectedNode"
          (onNodeSelect)="onNodeSelect($event)"
          [filter]="true"
          filterPlaceholder="Cerca dipendente..."
          scrollHeight="400px"
          [pt]="{
                 root: { class: 'bg-red-200 border-2 border-black-500' },
              }"
        >
        </p-tree>

        <div class="mt-4">
          <p>
            Nodo Selezionato: @if(selectedNode(); as node){
            <strong>{{node.label}}</strong>
            <small class="block text-secondary mt-1">Tipo: {{node.type}}</small>
            } @else {
            <span class="text-500">Nessuno</span>
            }
          </p>
        </div>
      </p-card>
    </div>

    <div class="col-12 md:col-6">
      <p-card header="Azioni Avanzate (Directives)">
        <p>Clicca sotto per gestire i permessi (pStyleClass Animations)</p>

        <p-button
          label="Apri Pannello Permessi"
          icon="pi pi-cog"
          pStyleClass="#mySidebar"
          toggleClass="sidebar-visible"
        ></p-button>
      </p-card>
    </div>
  </div>
</div>

<div id="mySidebar" class="sidebar-panel">
  <div class="flex justify-content-between align-items-center mb-4">
    <h2 class="m-0">Permessi Utente</h2>

    <p-button
      icon="pi pi-times"
      [rounded]="true"
      [text]="true"
      pStyleClass="#mySidebar"
      enterToClass="sidebar-visible"
      leaveToClass="transform translate-x-full"
      toggleClass="sidebar-visible"
    ></p-button>
  </div>

  <div class="mb-3">
    @if (selectedNode(); as node) {
    <p class="text-sm text-600">
      Assegna permessi a: <strong class="text-900">{{ node.label }}</strong>
    </p>
    } @else {
    <p class="text-sm text-red-500">Seleziona un utente dall'albero per iniziare.</p>
    }
  </div>

  <p-picklist
    [source]="sourcePermissions()"
    [target]="targetPermissions()"
    ariaLabel="Assegna permessi agli utenti"
    ariaLabelledBy="picklist-label"
    sourceHeader="Permessi Disponibili"
    targetHeader="Permessi Assegnati"
    [dragdrop]="true"
    [responsive]="true"
    filterBy="name"
    sourceFilterPlaceholder="Cerca permesso..."
    targetFilterPlaceholder="Cerca assegnato..."
    breakpoint="1400px"
    scrollHeight="20rem"
  >
    <ng-template pTemplate="item" let-perm>
      <div class="flex flex-column gap-1 p-2 border-bottom-1 surface-border">
        <span class="font-bold text-900">{{ perm.name }}</span>
        <span class="text-sm text-600">{{ perm.description }}</span>
      </div>
    </ng-template>
  </p-picklist>

  <div class="mt-3 flex justify-content-end">
    <p-button
      label="Salva Modifiche"
      icon="pi pi-check"
      [disabled]="!selectedNode()"
      (click)="onSaveClicked()"
    ></p-button>
  </div>
</div>
